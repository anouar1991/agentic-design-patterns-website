import{r as i,b as k,j as e,L as f}from"./vendor-react-DN_ejfqU.js";import{s as N,f as v,i as w,e as E,C as y}from"./index-BKkGv93R.js";import{a0 as C,T as S,K as R,e as L,R as U,au as T,av as A,aw as p}from"./vendor-icons-Bk2E3XEa.js";import{m as F}from"./vendor-motion-DGNCB2r1.js";import"./vendor-i18n-Dd5EwQCs.js";import"./app-i18n-C5tc3coy.js";import"./vendor-syntax-CTqyvmNs.js";import"./data-chapters-BbORdiqp.js";import"./data-codeterms-Bj5uvpbk.js";import"./data-misc-BXUciVTh.js";const _=v("Leaderboard");function O({countryFilter:r=null,limit:a=50}={}){const[l,n]=i.useState([]),[h,b]=i.useState(!0),[d,c]=i.useState(null),x=w(),g=i.useCallback(async()=>{if(!x){b(!1);return}b(!0),c(null);try{let o=N.from("leaderboard_cache").select("*").order("global_rank",{ascending:!0}).limit(a);r&&(o=o.eq("country_code",r));const{data:u,error:m}=await o;if(m)throw m;const t=(u||[]).filter(s=>s.user_id!==null).map(s=>({user_id:s.user_id,display_name:s.display_name,avatar_url:s.avatar_url,country_code:s.country_code,completed_chapters:s.completed_chapters??0,completion_percentage:s.completion_percentage??0,global_rank:s.global_rank??0}));n(t)}catch(o){const u=JSON.stringify(o),m=u.includes("Failed to fetch")||u.includes("ERR_CONNECTION_REFUSED")||u.includes("NetworkError");m||_.error("Error fetching leaderboard:",o);const t=o instanceof Error?o.message:typeof o=="object"&&o!==null&&"message"in o?String(o.message):"Failed to fetch leaderboard";c(m?"Unable to connect to server":t)}finally{b(!1)}},[x,r,a]);return i.useEffect(()=>{g()},[g]),{entries:l,loading:h,error:d,refresh:g,isConfigured:x}}async function q(r){if(!w())return null;try{const{data:a,error:l}=await N.from("leaderboard_cache").select("*").eq("user_id",r).single();if(l){const n=JSON.stringify(l);return n.includes("Failed to fetch")||n.includes("ERR_CONNECTION_REFUSED")||n.includes("NetworkError")||_.error("Error fetching user rank:",l),null}return!a||a.user_id===null?null:{user_id:a.user_id,display_name:a.display_name,avatar_url:a.avatar_url,country_code:a.country_code,completed_chapters:a.completed_chapters??0,completion_percentage:a.completion_percentage??0,global_rank:a.global_rank??0}}catch{return null}}function D(r){return r&&y.find(l=>l.code===r)?.flag||""}function I({rank:r}){return r===1?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-yellow-400 to-yellow-600 flex items-center justify-center shadow-lg shadow-yellow-500/30",children:e.jsx(A,{className:"w-4 h-4 text-dark-50"})}):r===2?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-300 to-gray-500 flex items-center justify-center shadow-lg shadow-gray-400/30",children:e.jsx(p,{className:"w-4 h-4 text-dark-50"})}):r===3?e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-amber-600 to-amber-800 flex items-center justify-center shadow-lg shadow-amber-600/30",children:e.jsx(p,{className:"w-4 h-4 text-dark-50"})}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-dark-800 flex items-center justify-center text-sm font-medium text-dark-400",children:r})}function j({entry:r,isCurrentUser:a}){const l=r.display_name||"Anonymous",n=D(r.country_code);return e.jsxs(F.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex items-center gap-4 p-4 rounded-xl transition-colors ${a?"bg-blue-900/20 ring-2 ring-blue-500/50":"bg-dark-800/50 hover:bg-dark-800"}`,children:[e.jsx(I,{rank:r.global_rank}),r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:l,width:40,height:40,loading:"lazy",className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-white font-medium",children:l.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-dark-50 truncate",children:l}),n&&e.jsx("span",{className:"text-lg",children:n}),a&&e.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-900/50 text-blue-400 rounded-full",children:"You"})]}),e.jsxs("div",{className:"text-sm text-dark-400",children:[r.completed_chapters," / 21 chapters"]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-3",children:[e.jsx("div",{className:"w-32 h-2 bg-dark-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-600 rounded-full transition-all duration-500",style:{width:`${r.completion_percentage}%`}})}),e.jsxs("span",{className:"text-sm font-medium text-dark-300 w-12 text-right",children:[r.completion_percentage,"%"]})]})]})}function W(){const{t:r}=k(),{user:a}=E(),[l,n]=i.useState(null),[h,b]=i.useState(null),{entries:d,loading:c,error:x,refresh:g,isConfigured:o}=O({countryFilter:l,limit:50});i.useEffect(()=>{a&&q(a.id).then(b).catch(()=>{})},[a]);const u=i.useMemo(()=>{const t=new Set;return d.forEach(s=>{s.country_code&&t.add(s.country_code)}),y.filter(s=>t.has(s.code))},[d]),m=a&&d.some(t=>t.user_id===a.id);return o?e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-yellow-900/30 rounded-full text-yellow-300 text-sm font-medium mb-4",children:[e.jsx(S,{className:"w-4 h-4"}),r("leaderboard.badge","Top Learners")]}),e.jsx("h1",{className:"text-4xl font-bold text-dark-50 mb-2",children:r("leaderboard.title","Leaderboard")}),e.jsx("p",{className:"text-dark-400 max-w-lg mx-auto",children:r("leaderboard.subtitle","See how you rank against other learners mastering agentic design patterns")})]}),a&&h&&!m&&e.jsxs("div",{className:"mb-6 p-4 bg-blue-900/20 rounded-xl border border-blue-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-400 mb-2",children:[e.jsx(R,{className:"w-4 h-4"}),r("leaderboard.yourRank","Your Rank")]}),e.jsx(j,{entry:h,isCurrentUser:!0})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-gray-400"}),e.jsxs("select",{value:l||"",onChange:t=>n(t.target.value||null),className:"px-3 py-2 bg-dark-800 border border-dark-600 rounded-lg text-sm text-dark-200 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:r("leaderboard.allCountries","All countries")}),u.map(t=>e.jsxs("option",{value:t.code,children:[t.flag," ",t.name]},t.code))]})]}),e.jsxs("button",{onClick:g,disabled:c,className:"flex items-center gap-2 px-3 py-2 text-sm text-dark-300 hover:text-blue-400 transition-colors disabled:opacity-50",children:[e.jsx(U,{className:`w-4 h-4 ${c?"animate-spin":""}`}),r("common.refresh","Refresh")]})]}),x&&e.jsx("div",{className:"mb-6 p-4 bg-red-900/20 rounded-xl text-red-400 text-center",children:x}),c&&d.length===0&&e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((t,s)=>e.jsx("div",{className:"h-20 bg-dark-800 rounded-xl animate-pulse"},s))}),!c&&d.length===0&&e.jsxs("div",{className:"text-center py-16 bg-dark-800/50 rounded-2xl",children:[e.jsx(T,{className:"w-16 h-16 mx-auto mb-4 text-dark-400"}),e.jsx("h3",{className:"text-xl font-semibold text-dark-50 mb-2",children:r("leaderboard.noEntries","No learners yet")}),e.jsx("p",{className:"text-dark-400",children:l?r("leaderboard.noEntriesCountry","No learners from this country yet"):r("leaderboard.beFirst","Be the first to complete a chapter!")})]}),d.length>0&&e.jsx("div",{className:"space-y-3",children:d.map((t,s)=>e.jsx(j,{entry:{...t,global_rank:s+1},isCurrentUser:a?.id===t.user_id},t.user_id))}),!a&&d.length>0&&e.jsxs("div",{className:"mt-8 p-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl text-center text-white",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:r("leaderboard.joinCta","Want to join the leaderboard?")}),e.jsx("p",{className:"text-blue-100 mb-4",children:r("leaderboard.joinCtaDesc","Sign in to track your progress and compete with other learners")}),e.jsx(f,{to:"/introduction",className:"inline-block px-6 py-2 bg-white text-blue-600 font-medium rounded-lg hover:bg-blue-50 transition-colors",children:r("leaderboard.startLearning","Start learning")})]})]}):e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-12",children:e.jsxs("div",{className:"text-center py-16 bg-dark-800/50 rounded-2xl",children:[e.jsx(C,{className:"w-16 h-16 mx-auto mb-4 text-amber-500"}),e.jsx("h2",{className:"text-2xl font-bold text-dark-50 mb-2",children:r("leaderboard.notConfigured","Leaderboard Not Available")}),e.jsx("p",{className:"text-dark-400 max-w-md mx-auto",children:r("leaderboard.notConfiguredDesc","The leaderboard requires Supabase to be configured. Your progress is still tracked locally.")}),e.jsx(f,{to:"/learning-path",className:"inline-flex items-center gap-2 mt-6 px-4 py-2 bg-blue-600 text-dark-50 rounded-lg hover:bg-blue-700 transition-colors",children:r("leaderboard.viewProgress","View your progress")})]})})}export{W as default};
