import{r as u,j as e,N as H,L as z}from"./vendor-react-DN_ejfqU.js";import{e as L,b as O,i as U,s as $,k as X,m as J,n as K}from"./index-BKkGv93R.js";import{c as W}from"./data-chapters-BbORdiqp.js";import{m as h}from"./vendor-motion-DGNCB2r1.js";import{ax as q,a3 as Z,X as B,ay as Y,T as F,N as w,r as T,az as V,O as M,Z as R,aw as I,K as ee,av as te,q as se,y as Q,ar as ae,aA as re}from"./vendor-icons-Bk2E3XEa.js";import"./vendor-i18n-Dd5EwQCs.js";import"./app-i18n-C5tc3coy.js";import"./vendor-syntax-CTqyvmNs.js";import"./data-codeterms-Bj5uvpbk.js";import"./data-misc-BXUciVTh.js";const E={chaptersCompleted:0,quizStats:{totalAttempts:0,passedAttempts:0,averageScore:0,perfectScores:0},streak:0,lastActiveDate:null,recentActivity:[],achievements:[]};function ie(){const{user:d}=L(),{completedChapters:m}=O(),[C,y]=u.useState(E),[n,v]=u.useState(!0),[S,_]=u.useState(null),D=s=>{if(s.length===0)return 0;const a=[...s].map(i=>new Date(i).toDateString()).filter((i,o,x)=>x.indexOf(i)===o).sort((i,o)=>new Date(o).getTime()-new Date(i).getTime()),l=new Date().toDateString(),r=new Date(Date.now()-864e5).toDateString();if(a[0]!==l&&a[0]!==r)return 0;let g=1;for(let i=0;i<a.length-1;i++){const o=new Date(a[i]),x=new Date(a[i+1]);if((o.getTime()-x.getTime())/864e5===1)g++;else break}return g},f=(s,a,l)=>{const r=[];return s>=1&&r.push("first_chapter"),s>=5&&r.push("five_chapters"),s>=10&&r.push("halfway"),s>=21&&r.push("completionist"),a.passedAttempts>=1&&r.push("quiz_rookie"),a.passedAttempts>=10&&r.push("quiz_master"),a.perfectScores>=1&&r.push("perfect_score"),a.perfectScores>=5&&r.push("perfectionist"),l>=3&&r.push("streak_3"),l>=7&&r.push("streak_7"),l>=30&&r.push("streak_30"),r},j=u.useCallback(async()=>{if(!U()||!d){const s=f(m.length,E.quizStats,0);y({...E,chaptersCompleted:m.length,achievements:s}),v(!1);return}try{v(!0),_(null);const{data:s,error:a}=await $.from("progress").select("chapter_id, completed_at").eq("user_id",d.id).order("completed_at",{ascending:!1});if(a)throw a;const{data:l,error:r}=await $.from("quiz_attempts").select("score, total_questions, passed").eq("user_id",d.id);if(r)throw r;const g={totalAttempts:l?.length||0,passedAttempts:l?.filter(p=>p.passed).length||0,averageScore:l&&l.length>0?Math.round(l.reduce((p,N)=>p+N.score/N.total_questions*100,0)/l.length):0,perfectScores:l?.filter(p=>p.score===p.total_questions).length||0},i=[...s?.map(p=>p.completed_at)||[]],o=D(i),x=s?.slice(0,5)||[],k=f(s?.length||0,g,o);y({chaptersCompleted:s?.length||0,quizStats:g,streak:o,lastActiveDate:s?.[0]?.completed_at||null,recentActivity:x,achievements:k})}catch(s){const a=JSON.stringify(s);a.includes("Failed to fetch")||a.includes("NetworkError")||_(s instanceof Error?s:new Error("Failed to fetch profile stats"))}finally{v(!1)}},[d,m.length]);return u.useEffect(()=>{j()},[j]),{stats:C,loading:n,error:S,refetch:j}}const le={first_chapter:{icon:ae,title:"First Steps",description:"Complete your first chapter",color:"#f59e0b"},five_chapters:{icon:Q,title:"Getting Started",description:"Complete 5 chapters",color:"#3b82f6"},halfway:{icon:se,title:"Halfway There",description:"Complete 10 chapters",color:"#8b5cf6"},completionist:{icon:te,title:"Completionist",description:"Complete all 21 chapters",color:"#f59e0b"},quiz_rookie:{icon:w,title:"Quiz Rookie",description:"Pass your first quiz",color:"#10b981"},quiz_master:{icon:F,title:"Quiz Master",description:"Pass 10 quizzes",color:"#f97316"},perfect_score:{icon:ee,title:"Perfect!",description:"Get a perfect score on a quiz",color:"#ec4899"},perfectionist:{icon:I,title:"Perfectionist",description:"Get 5 perfect quiz scores",color:"#a855f7"},streak_3:{icon:q,title:"On Fire",description:"3-day learning streak",color:"#ef4444"},streak_7:{icon:R,title:"Week Warrior",description:"7-day learning streak",color:"#f59e0b"},streak_30:{icon:M,title:"Dedicated Learner",description:"30-day learning streak",color:"#14b8a6"}},ne=Object.fromEntries(Object.entries(W).map(([d,m])=>[Number(d),m.shortTitle||m.title]));function je(){const{user:d,profile:m,loading:C,updateProfile:y}=L(),{stats:n,loading:v}=ie(),{completedChapters:S,isChapterCompleted:_}=O(),[D,f]=u.useState(!1),[j,s]=u.useState(""),[a,l]=u.useState(!1);if(!C&&!d)return e.jsx(H,{to:"/",replace:!0});const r=C||v,g=async t=>{await y({country_code:t})},i=m?.display_name||d?.email?.split("@")[0]||"Learner",o=m?.avatar_url,x=m?.country_code,k=Math.round(n.chaptersCompleted/21*100),p=()=>{s(i),f(!0)},N=()=>{f(!1),s("")},P=async()=>{const t=j.trim();if(!t||t===i){N();return}l(!0),await y({display_name:t}),l(!1),f(!1)};return e.jsx("div",{className:"min-h-screen py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass rounded-2xl p-8 mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[o?e.jsx("img",{src:o,alt:i,width:96,height:96,loading:"lazy",className:"w-24 h-24 rounded-full object-cover ring-4 ring-primary-500/30"}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center text-white text-3xl font-bold ring-4 ring-primary-500/30",children:i.charAt(0).toUpperCase()}),n.streak>=3&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 bg-amber-500 rounded-full flex items-center justify-center",children:e.jsx(q,{className:"w-5 h-5 text-dark-50"})})]}),e.jsxs("div",{className:"text-center md:text-left flex-1",children:[D?e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",value:j,onChange:t=>s(t.target.value),onKeyDown:t=>{t.key==="Enter"&&P(),t.key==="Escape"&&N()},className:"text-2xl font-bold bg-dark-800 text-dark-50 border border-dark-600 rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-primary-500 w-full max-w-xs",autoFocus:!0,maxLength:40,disabled:a}),e.jsx("button",{onClick:P,disabled:a,className:"p-1.5 rounded-lg bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30 transition-colors disabled:opacity-50",title:"Save",children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsx("button",{onClick:N,disabled:a,className:"p-1.5 rounded-lg bg-dark-700 text-dark-400 hover:bg-dark-600 transition-colors disabled:opacity-50",title:"Cancel",children:e.jsx(B,{className:"w-5 h-5"})})]}):e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-dark-50",children:i}),e.jsx("button",{onClick:p,className:"p-1.5 rounded-lg text-dark-500 hover:text-dark-300 hover:bg-dark-700 transition-colors",title:"Edit display name",children:e.jsx(Y,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-dark-400 mb-3",children:d?.email}),e.jsxs("div",{className:"flex flex-wrap justify-center md:justify-start gap-3",children:[x&&e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-dark-700 text-sm",children:[e.jsx("span",{className:"text-lg",children:X[x]}),e.jsx("span",{className:"text-dark-300",children:J[x]})]}),e.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-400 text-sm",children:[e.jsx(F,{className:"w-4 h-4"}),n.chaptersCompleted,"/21 Chapters"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 rounded-lg bg-dark-800",children:[e.jsx("div",{className:"text-2xl font-bold text-dark-50",children:n.streak}),e.jsxs("div",{className:"text-xs text-dark-400 flex items-center justify-center gap-1",children:[e.jsx(q,{className:"w-3 h-3 text-amber-500"}),"Day Streak"]})]}),e.jsxs("div",{className:"text-center p-3 rounded-lg bg-dark-800",children:[e.jsx("div",{className:"text-2xl font-bold text-dark-50",children:n.quizStats.passedAttempts}),e.jsxs("div",{className:"text-xs text-dark-400 flex items-center justify-center gap-1",children:[e.jsx(w,{className:"w-3 h-3 text-emerald-500"}),"Quizzes Passed"]})]})]})]}),!x&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-dark-700",children:[e.jsx("p",{className:"text-sm text-dark-400 mb-3",children:"Set your country to appear on the leaderboard:"}),e.jsx("div",{className:"max-w-xs",children:e.jsx(K,{value:null,onChange:g})})]})]}),e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"glass rounded-2xl p-6 mb-8",children:[e.jsxs("h2",{className:"text-lg font-semibold text-dark-50 mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-primary-400"}),"Learning Progress"]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-dark-50",children:n.chaptersCompleted}),e.jsx("div",{className:"text-sm text-dark-400",children:"Chapters Completed"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-dark-50",children:n.quizStats.totalAttempts}),e.jsx("div",{className:"text-sm text-dark-400",children:"Quiz Attempts"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsxs("div",{className:"text-3xl font-bold text-dark-50",children:[n.quizStats.averageScore,"%"]}),e.jsx("div",{className:"text-sm text-dark-400",children:"Average Quiz Score"})]}),e.jsxs("div",{className:"bg-dark-800 rounded-lg p-4",children:[e.jsx("div",{className:"text-3xl font-bold text-dark-50",children:n.quizStats.perfectScores}),e.jsx("div",{className:"text-sm text-dark-400",children:"Perfect Scores"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-dark-400",children:"Overall Completion"}),e.jsxs("span",{className:"text-primary-400 font-medium",children:[k,"%"]})]}),e.jsx("div",{className:"h-3 bg-dark-700 rounded-full overflow-hidden",children:e.jsx(h.div,{className:"h-full bg-gradient-to-r from-primary-500 to-accent-500 rounded-full origin-left",initial:{scaleX:0},animate:{scaleX:k/100},transition:{duration:.8,ease:"easeOut"}})})]}),e.jsxs("p",{className:"text-sm text-dark-500",children:[21-n.chaptersCompleted," chapters remaining"]})]}),e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"glass rounded-2xl p-6 mb-8",children:[e.jsxs("h2",{className:"text-lg font-semibold text-dark-50 mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-accent-400"}),"Chapter Progress Map"]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-7 gap-2",children:Array.from({length:21},(t,c)=>c+1).map(t=>{const c=_(t),A=ne[t]||`Ch ${t}`;return e.jsxs(z,{to:`/chapter/${t}`,className:`relative group p-2 rounded-lg text-center transition-all ${c?"bg-emerald-500/20 border border-emerald-500/30 hover:bg-emerald-500/30":"bg-dark-800 border border-dark-700 hover:border-dark-500"}`,title:`Chapter ${t}: ${A}`,children:[e.jsx("div",{className:`text-xs font-bold mb-0.5 ${c?"text-emerald-400":"text-dark-500"}`,children:t}),e.jsx("div",{className:`text-[10px] leading-tight truncate ${c?"text-emerald-300":"text-dark-600"}`,children:A}),c&&e.jsx(w,{className:"w-3 h-3 text-emerald-500 absolute -top-1 -right-1"})]},t)})}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-xs text-dark-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-emerald-500/20 border border-emerald-500/30 inline-block"}),"Completed (",S.length,")"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-dark-800 border border-dark-700 inline-block"}),"Remaining (",21-S.length,")"]})]})]}),e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"glass rounded-2xl p-6 mb-8",children:[e.jsxs("h2",{className:"text-lg font-semibold text-dark-50 mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-amber-400"}),"Achievements"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(le).map(([t,c],A)=>{const G=c.icon,b=n.achievements.includes(t);return e.jsxs(h.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:A*.05},className:`relative p-4 rounded-xl text-center transition-all ${b?"bg-dark-800 border border-dark-600":"bg-dark-800/50 opacity-50"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full mx-auto mb-2 flex items-center justify-center ${b?"":"grayscale"}`,style:{backgroundColor:b?`${c.color}20`:"#374151"},children:e.jsx(G,{className:"w-6 h-6",style:{color:b?c.color:"#6b7280"}})}),e.jsx("div",{className:`text-sm font-medium ${b?"text-dark-50":"text-dark-500"}`,children:c.title}),e.jsx("div",{className:"text-xs text-dark-500 mt-1",children:c.description}),b&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-emerald-500 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-3 h-3 text-dark-50"})})]},t)})})]}),n.recentActivity.length>0&&e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"glass rounded-2xl p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-dark-50 mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-blue-400"}),"Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:n.recentActivity.map((t,c)=>e.jsxs(h.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:c*.1},className:"flex items-center justify-between p-3 rounded-lg bg-dark-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center",children:e.jsx(w,{className:"w-4 h-4 text-emerald-500"})}),e.jsx("div",{children:e.jsxs(z,{to:`/chapter/${t.chapter_id}`,className:"text-dark-50 hover:text-primary-400 transition-colors",children:["Chapter ",t.chapter_id," Completed"]})})]}),e.jsx("div",{className:"text-sm text-dark-500",children:new Date(t.completed_at).toLocaleDateString()})]},`${t.chapter_id}-${t.completed_at}`))}),e.jsxs(z,{to:"/learning-path",className:"mt-4 inline-flex items-center gap-2 text-primary-400 hover:text-primary-300 text-sm",children:["Continue Learning",e.jsx(T,{className:"w-4 h-4"})]})]}),n.chaptersCompleted===0&&!r&&e.jsxs(h.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-dark-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-dark-50 mb-2",children:"Start Your Journey"}),e.jsx("p",{className:"text-dark-400 mb-6",children:"Complete chapters and quizzes to earn achievements and track your progress."}),e.jsxs(z,{to:"/chapter/1",className:"inline-flex items-center gap-2 px-6 py-3 rounded-lg bg-gradient-to-r from-primary-500 to-accent-500 text-white font-medium hover:opacity-90 transition-opacity",children:["Start with Chapter 1",e.jsx(R,{className:"w-4 h-4"})]})]})]})})}export{je as default};
